%% fixture_id: c4_deployment_stress
%% purpose: stress test with many deployment nodes and containers
C4Deployment
  title Production Deployment
  Deployment_Node(aws, "AWS", "Cloud") {
    Deployment_Node(region, "us-east-1", "Region") {
      Deployment_Node(vpc, "VPC") {
        Deployment_Node(pub_sub, "Public Subnet") {
          Deployment_Node(alb, "ALB") {
            Container(lb, "Load Balancer", "ALB")
          }
        }
        Deployment_Node(priv_sub, "Private Subnet") {
          Deployment_Node(ecs, "ECS Cluster") {
            Container(api1, "API Instance 1", "Docker")
            Container(api2, "API Instance 2", "Docker")
            Container(worker1, "Worker 1", "Docker")
          }
          Deployment_Node(rds, "RDS") {
            ContainerDb(primary, "Primary DB", "PostgreSQL")
            ContainerDb(replica, "Read Replica", "PostgreSQL")
          }
          Deployment_Node(elasticache, "ElastiCache") {
            ContainerDb(redis, "Redis", "Redis 7")
          }
        }
      }
    }
    Deployment_Node(s3_node, "S3") {
      Container(bucket, "Assets Bucket", "S3")
    }
    Deployment_Node(cf_node, "CloudFront") {
      Container(cdn, "CDN", "CloudFront")
    }
  }
  Rel(lb, api1, "Routes")
  Rel(lb, api2, "Routes")
  Rel(api1, primary, "R/W")
  Rel(api2, replica, "Reads")
  Rel(api1, redis, "Caches")
  Rel(cdn, bucket, "Serves")
